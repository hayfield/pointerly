<!DOCTYPE HTML> 
<html lang="en"> 
<head> 
	<title>Pointerly</title> 
	<meta charset="utf-8"> 
	<link rel="stylesheet" type="text/css" href="css/pointerly.css" />

	<script type="text/javascript" src="src/lib/Detector.js"></script> 
	<script type="text/javascript" src="src/lib/RequestAnimationFrame.js"></script>

	<script type="text/javascript" src="src/js/Pointerly.js"></script>

	<script type="text/javascript" src="src/js/core/Storage.js"></script>
	<script type="text/javascript" src="src/js/core/Logger.js"></script>
	<script type="text/javascript" src="src/js/core/Utils.js"></script>
	<script type="text/javascript" src="src/js/core/Scene.js"></script>
	<script type="text/javascript" src="src/js/core/Home.js"></script>
	<script type="text/javascript" src="src/js/core/Renderer.js"></script>
	<script type="text/javascript" src="src/js/core/Init.js"></script>

	<script type="text/javascript" src="src/js/display/Shape.js"></script>
	<script type="text/javascript" src="src/js/display/Shapes.js"></script>
	<script type="text/javascript" src="src/js/display/Triangle.js"></script>
	<script type="text/javascript" src="src/js/display/Circle.js"></script>
	<script type="text/javascript" src="src/js/display/Rectangle.js"></script>

	<script type="text/javascript" src="src/js/display/ShapeGeneration.js"></script>

	<script type="text/javascript" src="src/js/environment/ClickHandler.js"></script>
	<script type="text/javascript" src="src/js/environment/Environment.js"></script>
	
</head> 
<body>

<script type="text/javascript">
var OBSERVATION = {};
OBSERVATION.NONE = 1;
OBSERVATION.REMOTE = 2;
OBSERVATION.FAR = 3;
OBSERVATION.CLOSE = 4;

var positions = [600, 200,-200, -600],
	widths = [16, 32, 48, 64],
	combinations = [],
	shouldGenerateShapes = false,
	order = [],
	currentObservationType,
	observationNumber = 0,
	startingTest = true;

var observationOrder = [
	OBSERVATION.NONE,
	OBSERVATION.REMOTE,
	OBSERVATION.FAR,
	OBSERVATION.CLOSE
];

var startNextObservation = function( event ){
	var I_KEY = 73;
	if( event.keyCode === I_KEY ){
		shouldGenerateShapes = true;
		document.removeEventListener( 'keyup', startNextObservation );
		//Pointerly.CURRENT_ENVIRONMENT.generateShapes();
	}
};

var generateCombinations = function(){
	for(var i = 0; i < positions.length; i++){
		for(var j = 0; j < widths.length; j++){
			combinations.push({
				position: positions[i],
				width: widths[j]
			});
		}
	}

	combinations.sort(function(){
		return Math.random - 0.5;
	});
};

var recText = function( shapeSetup ){
	Pointerly.Shape.call( this, shapeSetup );

	this.draw = function( settings ){
		var width = settings.width,
			height = settings.height,
			ctx = settings.ctx;
	
		ctx.font = '15px Arial';
		ctx.fillText('Recording Activated', 0, 12);
	};

	this.display( this.draw );
};

recText.prototype = new Pointerly.Shape;
recText.prototype.constructor = recText;

recText.prototype.toString = function(){
	return 'Recording';
};


var setup = {
	shapeLayout: function( environment ){
		if( shouldGenerateShapes ){
			var element = combinations.shift(),
				canvas = environment.renderer.domElement;
			shouldGenerateShapes = false;
			environment.addShape(new Pointerly.Shapes.Rectangle({
				width: element.width,
				height: canvas.height,
				position: new Pointerly.Vector2( canvas.width/2 - element.position/2 - element.width/2, 0 )
			}));
			if (currentObservationType === OBSERVATION.REMOTE) {
				environment.addShape(new recText({
					width: 150,
					height: 60,
					position: new Pointerly.Vector2( 0, 10 )
				}));
			}
		}
	},
	clickType: 'mouse',
	onShapeClick: function( environment, shape ){
		shouldGenerateShapes = true;
		environment.removeShape( shape );
		if( combinations.length === 0 ){
			environment.logger.save();
			startingTest = true;
		}
	},
	homePosition: {
		onEnter: function(){
			if( combinations.length > 0 && shouldGenerateShapes ){
				Pointerly.CURRENT_ENVIRONMENT.generateShapes();
			} else if( combinations.length === 0 && startingTest ){
				currentObservationType = observationOrder[observationNumber];
				if( typeof currentObservationType !== 'undefined' ){
					generateCombinations();
					observationNumber++;
					startingTest = false;
					shouldGenerateShapes = false;
					document.addEventListener( 'keyup', startNextObservation );
				}
			}
		}
	}
};

Pointerly.Init( setup );

</script>
</body> 
</html>
